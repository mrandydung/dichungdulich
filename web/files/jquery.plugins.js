$jsbz("input[placeholder], textarea[placeholder]").placeholder();SUBIZ.init_config();SUBIZ.init_session("n");$jsbz("#subiz_body_input").live("keypress",function(c){if(c.which===13){c.preventDefault();var a=$jsbz("#subiz_body_input").val();if(a==""){return false}if(SUBIZ.connection!=null&&SUBIZ.connection.sid!=null){SUBIZ.send_msg(a);SUBIZ.append_msg(a);if(SUBIZ.get_config("start_activity")!="y"){SUBIZ.set_config("start_activity","y");SUBIZ.start_activity()}if(SUBIZ.get_config("triggers").length>0){SUBIZ.run_triggers("chat_message")}}else{SUBIZ.pending_msg.push(a);SUBIZ.append_msg(a);if(SUBIZ.get_config("is_pending")!="y"){SUBIZ.init_session("y")}}SUBIZ.save_history("",a);$jsbz("#subiz_type").data("composing",false);$jsbz("#subiz_body_input").val("");SUBIZ.set_config("chat_on_last_url","yes")}else{if(SUBIZ.connection!=null&&SUBIZ.connection.sid!=null){if(SUBIZ.get_config("current_operator")!=""){var d=$jsbz("#subiz_type").data("composing");if(!d){var b=$msg({to:SUBIZ.get_config("current_operator"),type:"chat"}).c("composing",{xmlns:"http://jabber.org/protocol/chatstates"});SUBIZ.connection.send(b);$jsbz("#subiz_type").data("composing",true)}}}}SUBIZ.scroll_chat()});$jsbz(window).unload(function(){if(SUBIZ.connection!=null&&SUBIZ.connection.sid!=null){SUBIZ.set_config("jid",SUBIZ.connection.jid);SUBIZ.set_config("rid",SUBIZ.connection.rid);SUBIZ.set_config("sid",SUBIZ.connection.sid)}var a=new Date();SUBIZ.set_config("end_time",a.getTime());SUBIZ.set_config("last_page",window.location.href)});$jsbz("#subiz_compressed_heading").live("click",function(){SUBIZ.expand()});$jsbz(".subiz_right_icon").live("click",function(){SUBIZ.shrink()});$jsbz("#subiz_banner").live("click",function(){if(SUBIZ.get_config("is_expand")=="n"){SUBIZ.expand()}else{SUBIZ.shrink()}});$jsbz("#subiz_offline_submit_input").live("click",function(){var c=$jsbz("#subiz_name_input").val();var b=$jsbz("#subiz_offline_email_input").val();var d=$jsbz("#subiz_offline_body_input").val();var a=$jsbz("#subiz_offline_phone_input").val();if(c==""||b==""||d==""||!SUBIZ.validateEmail(b)){$jsbz("#subiz_offline_error").show();return false}if(SUBIZ.strings.phone_active===true&&a==""&&typeof SUBIZ.strings.phone_field_required!="undefined"&&SUBIZ.strings.phone_field_required===true){$jsbz("#subiz_offline_error").show();return false}$jsbz.cookie("subiz_name",c,{expires:365*86400,path:"/"});$jsbz.cookie("subiz_email",b,{expires:365*86400,path:"/"});if(a!=""){$jsbz.cookie("subiz_phone",a,{expires:365*86400,path:"/"})}$jsbz("#subiz_offline_submit_input").attr("disabled","true");$jsbz.ajax({type:"GET",url:SUBIZ.base_url+"subiz/send_offline_msg",dataType:"jsonp",data:"client_id="+SUBIZ.get_config("client_id")+"&name="+encodeURIComponent(c)+"&email="+encodeURIComponent(b)+"&msg="+encodeURIComponent(d)+"&chat_on_url="+encodeURIComponent(window.location.href)+"&phone="+a,success:function(e){}});SUBIZ.log_event("Visitor send offline")});$jsbz("#subiz_compressed_heading").click(function(){if(SUBIZ.get_config("triggers").length>0){if(SUBIZ.get_config("current_state")=="online"&&SUBIZ.get_history().items.length==0&&SUBIZ.get_config("chat_requested")!="yes"){SUBIZ.set_config("chat_requested","yes");SUBIZ.run_triggers("chat_requested")}}});$jsbz("#subiz_button_start").live("click",function(){$jsbz("#subiz_button_start").attr("disabled",true);var c=true;if(SUBIZ.get_config("display_survey")=="yes"){var d=$jsbz("#subiz_survey_name").val();if(typeof SUBIZ.strings.name_field_required!="undefined"&&SUBIZ.strings.name_field_required==true&&d==""){$jsbz("#subiz_survey_name").css("border","1px solid red");c=false}else{$jsbz("#subiz_survey_name").css("border","1px solid #ccc")}var a=$jsbz("#subiz_survey_email").val();if((typeof SUBIZ.strings.email_field_required!="undefined"&&SUBIZ.strings.email_field_required==true&&(a==""||!SUBIZ.validateEmail(a)))||(a!=""&&!SUBIZ.validateEmail(a))){$jsbz("#subiz_survey_email").css("border","1px solid red");c=false}else{$jsbz("#subiz_survey_email").css("border","1px solid #ccc")}var e=$jsbz("#subiz_survey_phone").val();if(SUBIZ.strings.phone_active===true){if(typeof SUBIZ.strings.phone_field_required!="undefined"&&SUBIZ.strings.phone_field_required==true&&e==""){$jsbz("#subiz_survey_phone").css("border","1px solid red");c=false}else{$jsbz("#subiz_survey_phone").css("border","1px solid #ccc")}}}if(c===true){if(SUBIZ.get_config("display_survey")=="yes"){if(d!=""){$jsbz.cookie("subiz_name",d,{expires:365*86400,path:"/"});$jsbz("#subiz_visitor_name_input").val(d)}if(a!=""){$jsbz.cookie("subiz_email",a,{expires:365*86400,path:"/"});$jsbz("#subiz_visitor_email_input").val(a)}if(e!=""){$jsbz.cookie("subiz_phone",e,{expires:365*86400,path:"/"});SUBIZ.visitor_info.visitor_phone=e}if(d!=""&&a!=""){SUBIZ.visitor_info.name=d+" ("+a+")"}else{if(d==""&&a!=""){SUBIZ.visitor_info.name=a}else{if(d!=""&&a==""){SUBIZ.visitor_info.name=d}}}if(d!=""||a!=""||e!=""){SUBIZ.notify_status();$jsbz.ajax({type:"GET",url:SUBIZ.base_url+"subiz/save_survey",dataType:"jsonp",data:"client_id="+SUBIZ.get_config("client_id")+"&name="+encodeURIComponent(d)+"&email="+encodeURIComponent(a)+"&phone="+encodeURIComponent(e)+"&account_id="+subiz_account_id,success:function(f){}})}}var b=$jsbz("#subiz_survey_department").val();SUBIZ.set_config("current_department",b);$jsbz("#subiz_offline").hide();$jsbz("#subiz_prechat").hide();$jsbz("#subiz_online").show();$jsbz("#subiz-setting").show();SUBIZ.set_config("_start_chat","y")}else{$jsbz("#subiz_button_start").removeAttr("disabled")}});$jsbz("#closebanner").click(function(){$jsbz.cookie("subiz_closebanner","yes",{expires:30*86400,path:"/"});$jsbz("#subiz_banner").hide();return false});$jsbz("#subiz_resize_left").drag("start",function(b,a){a.width=$jsbz("#subiz_left_bottom").width();a.height=$jsbz("#subiz_left_bottom").height()}).drag(function(d,a){var e=$jsbz("#subiz_left_bottom");var f=$jsbz(window).width();var c=a.width-a.deltaX;var b=250;if(c<b){c=b}$jsbz("#subiz_left_bottom").css("width",c+"px");if(e.offset().left<5){w_sub=e.offset().left>0?5:Math.abs(e.offset().left)+5;c=c-w_sub;$jsbz("#subiz_left_bottom").css("width",c+"px")}SUBIZ.set_config("widget_w",c)});$jsbz("#subiz_resizeble").drag("start",function(b,a){a.width=$jsbz("#subiz_left_bottom").width();a.height=$jsbz("#subiz_left_bottom").height()}).drag(function(f,a){var h=$jsbz("#subiz_left_bottom");var e=$jsbz(window).height();var d=$jsbz("#subiz_conversion").height();var g=a.height-h.height()+d-a.deltaY;var c=212;if(g<c){g=c}$jsbz("#subiz_conversion").css("height",g+"px");var b=$jsbz(document).scrollTop();if(h.offset().top-b<5){h_sub=h.offset().top-b>0?5:Math.abs(h.offset().top-b)+5;g=g-h_sub;$jsbz("#subiz_conversion").css("height",g+"px")}SUBIZ.set_config("widget_h_conversion",g)});$jsbz("#subiz_expanded_heading").drag("start",function(b,a){a.width=$jsbz("#subiz_left_bottom").width();a.height=$jsbz("#subiz_left_bottom").height()}).drag(function(k,p){var n=window,i=document,h=i.documentElement,c=i.getElementsByTagName("body")[0],l=n.innerWidth||h.clientWidth||c.clientWidth,j=n.innerHeight||h.clientHeight||c.clientHeight;var f=j;var m=l;var m=$jsbz(window).width();var b=$jsbz("#subiz_left_bottom");var a=$jsbz(document).scrollTop()+f-p.offsetY-b.height();var o=m-p.offsetX-b.width();a=Math.max(0,Math.min(f-b.height()-5,a));o=Math.max(5,Math.min(m-b.width()-5,o));SUBIZ.set_config("widget_bottom",a);SUBIZ.set_config("widget_right",o);$jsbz("#subiz_left_bottom").css({bottom:a,right:o,left:"auto",top:"auto"})});$jsbz("#subiz-setting").click(function(){$jsbz(this).attr("class","subiz_setting_up");if($jsbz("#subiz-editname").is(":hidden")){$jsbz("#subiz-editname").show()}else{$jsbz("#subiz-editname").hide();$jsbz(this).attr("class","subiz_setting")}});$jsbz(".subiz_agent_up").click(function(){if(SUBIZ.get_config("current_operator")===""){return false}var a=SUBIZ.jid_to_us(SUBIZ.get_config("current_operator"));if(SUBIZ.get_config("vote_"+a)!=""){return false}SUBIZ.set_config("vote_"+a,"good");$jsbz(this).css("background-position","0px -70px");$jsbz.ajax({type:"GET",url:SUBIZ.base_url+"subiz/send_vote",dataType:"jsonp",data:"client_id="+SUBIZ.get_config("client_id")+"&vote=good&agent="+encodeURIComponent(SUBIZ.jid_to_us(SUBIZ.get_config("current_operator")))+"&account_id="+subiz_account_id+"&session_id="+$jsbz.cookie("PHPSESSID"),success:function(b){}})});$jsbz(".subiz_agent_down").click(function(){if(SUBIZ.get_config("current_operator")===""){return false}var a=SUBIZ.jid_to_us(SUBIZ.get_config("current_operator"));if(SUBIZ.get_config("vote_"+a)!=""){return false}SUBIZ.set_config("vote_"+a,"bad");$jsbz(this).css("background-position","0px -85px");$jsbz.ajax({type:"GET",url:SUBIZ.base_url+"subiz/send_vote",dataType:"jsonp",data:"client_id="+SUBIZ.get_config("client_id")+"&vote=bad&agent="+encodeURIComponent(SUBIZ.jid_to_us(SUBIZ.get_config("current_operator")))+"&account_id="+subiz_account_id+"&session_id="+$jsbz.cookie("PHPSESSID"),success:function(b){}})});$jsbz("#subiz_email_transcript_icon").click(function(){if($jsbz("#subiz_email_transcript").is(":hidden")){$jsbz("#subiz_email_transcript").show();$jsbz("#subiz_email_transcript_form").show()}else{$jsbz("#subiz_email_transcript").hide();$jsbz("#subiz_email_transcript_form").hide()}});$jsbz("#subiz_email_transcript_btn").click(function(){var a=$jsbz("#subiz_email_transcript_input").val();if(a!=""){if(SUBIZ.validateEmail(a)){$jsbz("#subiz_email_transcript_input").css("border","0px");$jsbz.ajax({type:"GET",url:SUBIZ.base_url+"subiz/visitor_set_email_transcript",dataType:"jsonp",data:"client_id="+SUBIZ.get_config("client_id")+"&email="+encodeURIComponent(a)+"&account_id="+subiz_account_id+"&session_id="+$jsbz.cookie("PHPSESSID")+"&callback=sbz_cb_email_transcript",success:function(b){}})}else{$jsbz("#subiz_email_transcript_input").css("border","1px solid red");return false}}else{}});$jsbz("#subiz_button_done").click(function(){var a={};a.name=$jsbz("#subiz_visitor_name_input").val();a.email=$jsbz("#subiz_visitor_email_input").val();if(a.name==""){$jsbz("#subiz_visitor_name_input").css("border","1px solid red");return false}else{$jsbz("#subiz_visitor_name_input").css("border","1px solid #AAA")}if(!SUBIZ.validateEmail(a.email)){$jsbz("#subiz_visitor_email_input").css("border","1px solid red");return false}else{$jsbz("#subiz_visitor_email_input").css("border","1px solid #AAA")}$jsbz.cookie("subiz_name",a.name,{expires:365*86400,path:"/"});$jsbz("#subiz_name_input").val($jsbz.cookie("subiz_name"));$jsbz("#subiz_survey_name").val($jsbz.cookie("subiz_name"));$jsbz.cookie("subiz_email",a.email,{expires:365*86400,path:"/"});$jsbz("#subiz_offline_email_input").val($jsbz.cookie("subiz_email"));$jsbz("#subiz_survey_email").val($jsbz.cookie("subiz_email"));$jsbz("#subiz_email_transcript_input").val($jsbz.cookie("subiz_email"));$jsbz.ajax({type:"GET",url:SUBIZ.base_url+"subiz/livechat_set",dataType:"jsonp",data:"client_id="+SUBIZ.get_config("client_id")+"&params="+encodeURIComponent(JSON.stringify(a))+"&account_id="+subiz_account_id+"&callback=sbz_cb_visitor_set_info",success:function(b){}})});$jsbz("#subiz_close_setting").click(function(){$jsbz("#subiz-setting").click()});function sbz_cb_email_transcript(a){if(a.status=="success"){$jsbz("#subiz_email_transcript").hide();$jsbz("#subiz_email_transcript_form").hide();SUBIZ.livechat.setEmail(a.email);$jsbz.cookie("subiz_email",a.email,{expires:365*86400,path:"/"});$jsbz("#subiz_offline_email_input").val($jsbz.cookie("subiz_email"));$jsbz("#subiz_survey_email").val($jsbz.cookie("subiz_email"));$jsbz("#subiz_visitor_email_input").val($jsbz.cookie("subiz_email"))}}function sbz_cb_offline_msg(a){if(a.status=="success"){$jsbz("#subiz_online").hide();$jsbz("#subiz_offline").hide();$jsbz("#subiz_offline_error").hide();$jsbz("#subiz_offline_message_sent_div").show();$jsbz("#subiz_offline_body_input").val("");$jsbz("#subiz_offline_submit_input").removeAttr("disabled")}}function sbz_cb_visitor_set_info(a){if(typeof a.nickname!="undefined"){SUBIZ.visitor_info.name=a.nickname;SUBIZ.notify_status()}if(a.status=="success"){$jsbz("#subiz-setting").click()}}function sbz_get_scrollbar_width(){var c=$jsbz('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div></div>');$jsbz("body").append(c);var b=$jsbz("div",c).innerWidth();c.css("overflow-y","auto");var a=$jsbz("div",c).innerWidth();$jsbz(c).remove();return(b-a)};